<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.5.1.js"
  integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
  crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>

<script src="//uniqueturker.myleott.com/lib.js" type="text/javascript"></script>


<div class="container">
  <div class="card">
    <h5 class="card-header bg-primary text-white">Instructions</h5>
    <div class="card-body bg-light">
      <p class="card-text">
        <!--strong style="color: red;">UPDATE</strong-->
        In this task, you will be asked to read three stories and <strong>identify when you think a new (minor/major) event starts</strong>; the aim is to segment each story into events. 
        <!--br>
        <strong style="color: red;">UPDATE below</strong-->
      </p>
      <ul>
        <li>Read each story and imagine what is going on as if you are observing the scenario.</li>
        <li>
          Select the <em>"a new minor/major event started"</em> buttons if you think a new event starts in the sentence, otherwise click <em>"no new event, proceed"</em> to read the next sentence.
          <!--ul>
            <li>We will let you decide what a major vs. minor event is, there is no right or wrong answer, just use your own interpretation.</li>
          </ul-->
        </li>
        <li><strong style="color: #CC0000; font-style: italic;">**New instruction**</strong> Please also differentiate expected or unsurprising events from unexpected or surprising events.</li>
        <!--li>We want you to segment the story into events.</li-->
        <li><strong>It is up to you to decide</strong> what makes a new event, what differentiates a major vs. minor event, and whether an event is expected; 
          there is no right or wrong answer, just use your own interpretation.
        </li>
      </ul>
      <p class="card-text">
        <em>Note:</em> This is a pilot task, please leave comments in the comment box!
      </p>
      <p class="card-text"><strong>Participation restriction</strong>: providers/turkers for this task cannot currently be employed by or a student at the University of Washington or Microsoft.</p>
      <p class="card-text"><em>This should take about 10-15 minutes</em>.</p>
      
    </div>
  </div>


  <div class="p-3">    
    <div class="row justify-content-center" id="consent-div">
      <div class="col-12 mt-4">
        <h5>Consent to the task</h5>
        <div class="form-check">
          <small><p>
            <strong>Data collection and sharing:</strong> During the project we will collect your Mechanical Turk ID, and may collect personal information about you such as age, gender, and race/ethnicity. We will not ask you for your name, or any other identifiable information. The personal information and other data collected during this project will be used primarily to perform research for purposes described in the introduction above.  Such information and data, or the results of the research may eventually be used to develop and improve our commercial products, services or technologies. By checking the box below, you are attesting that you've had time to read and consider this consent form and are comfortable with what is being asked of you as a participant. 
            We will securely store the data on our servers. We will not share your MTurk IDs outside of the research team.
            </p><p>
            If you wish to review or copy any information you provided during the study, or if you want us to delete or correct any such data, email your request to the research team at: msap@cs.washington.edu.  
            For additional information on how Microsoft handles your personal information, please see the <a href="https://privacy.microsoft.com/en-us/privacystatement">Microsoft Privacy Statement</a>.
          </p></small>
          <label class="form-check-label" for="consent">
            <input class="form-check-input" type="checkbox" id="consent" name="consent" onclick="toggleConsent(this.checked);" required>
            By ticking this box, you certify that you have <strong>read</strong> and <strong>understood</strong> the instructions, and have <strong>read</strong> and <strong>agree</strong> with <a href="https://homes.cs.washington.edu/~msap/debug/memoryAndLanguage/MemoryLanguage_ConsentForm.pdf" target="_blank">the terms of this study</a>.
          </label>
        </div>
        <br>
        <div class="alert alert-warning" id="consent-message" style="max-width: 400px;margin: auto;">
          You must check the box to continue the task!
        </div>

    </div>
    <div id="main-task" style="display: none;">
      <div class="row justify-content-center" >
        <div class="col-11 section" id="step1">
          <h4><label for="story">Step 1: Read the stories and select new events</label></h4>
          <span class="text-muted">Reminder, the aim is to segment ecah story into events by letting us know when you think a new event started.</span>

          <div id="story-slider-placeholder" style="display: none;">
            <div class="row justify-content-center" id="sentY-X" style="display: none;">
              <div class="col-7">
                <textarea class="sentence form-control mb-5" rows="3" disabled>sentText</textarea>
                <div class="sent-counter">sentIX / <span class="story-length"></span></div>
              </div>
              <div class="col-4" id="sentY-X-form">
                <label class="btn btn-sm btn-secondary form-check-label btn-left" onclick="nextSentence(Y);" for="sentY-X-major-surpr" style="background-color: #214b6e;">
                  <input class="form-check-input" type="radio" name="sentY-X-newEvent" id="sentY-X-major-surpr" value="major-surprising" style="display: none;" required>
                  <span  class="text-left">A new <strong>unexpected major</strong> event started</span>
                </label>
                <label class="btn btn-sm btn-secondary form-check-label btn-left mt-2" onclick="nextSentence(Y);" for="sentY-X-major-exp" style="background-color: #4b8abf;">
                  <input class="form-check-input" type="radio" name="sentY-X-newEvent" id="sentY-X-major-exp" value="major-expected" style="display: none;" required>
                  <span  class="text-left">A new <strong>unsurprising major</strong> event started</span>
                </label>
                <label class="btn btn-sm btn-secondary form-check-label btn-left mt-2" onclick="nextSentence(Y);" for="sentY-X-minor-surpr" style="background-color: #2e692c;">
                  <input class="form-check-input" type="radio" name="sentY-X-newEvent" id="sentY-X-minor-surpr" value="major-surprising" style="display: none;" required>
                  <span  class="text-left">A new <strong>unexpected minor</strong> event started</span>
                </label>
                <label class="btn btn-sm btn-secondary form-check-label btn-left mt-2" onclick="nextSentence(Y);" for="sentY-X-minor-exp" style="background-color: #5eb75c;">
                  <input class="form-check-input" type="radio" name="sentY-X-newEvent" id="sentY-X-minor-exp" value="minor-expected" style="display: none;" required>
                  <span  class="text-left">A new <strong>unsurprising minor</strong> event started</span>
                </label>
                <label class="btn btn-sm btn-secondary form-check-label btn-left mt-2 mb-2" onclick="nextSentence(Y);" for="sentY-X-no">
                  <input class="form-check-input" type="radio" name="sentY-X-newEvent" id="sentY-X-no" value="noEvent" style="display: none;" required>
                  <span class="text-left">No new event, proceed</span>
                </label>
                <!--div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                  <div class="btn-group-vertical mr-2" role="group" aria-label="First group">
                    
                    
                    
                  </div>
                </div-->
                <!--input type="button" id="sentX-next" class="btn mb-3 mt-3 btn-primary btn-sm" value="Next Sentence" onclick="nextSentence();"-->
                
              </div>
            </div>
          </div>
          <div id="story1">
            <div class="story-display">
              <h4>First story</h4>
              <div id="story1-slider">
               
              </div>
              <form>
                <div class="form-group">
                  <input type="range" class="form-control-range" id="progressBar1" disabled>
                </div>
              </form>
            </div>
          </div>
          <div id="story2">
            <hr>
            <div class="story-display">
              <h4>Second story</h4>
              <div id="story2-slider">
               
              </div>
              <form>
                <div class="form-group">
                  <input type="range" class="form-control-range" id="progressBar2" disabled>
                </div>
              </form>
            </div>
          </div>
          <div id="story3">
            <hr>
            <div class="story-display">
              <h4>Third story</h4>
              <div id="story3-slider">
               
              </div>
              <form>
                <div class="form-group">
                  <input type="range" class="form-control-range" id="progressBar3" disabled>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-11 section" id="step2" style="padding: 1em 0 8em 0;">
          <h4><label for="summary">Step 2: Summarize the third story</label></h4>
          <p>Please summarize what happened in the story, (write a few sentences, maximum a paragraph).</p>
          <div class="form-group">
            <textarea class="form-control" name="summary" id="summary" placeholder="summarize what happened here" rows="3" required></textarea>
          </div>
          <div id="summary-length-warning" class="col-6 alert alert-danger" style="display: none;">
            Summary must be between 100 and 1000 characters (including spaces).
          </div>
          <div id="summary-duplicate-warning" class="alert alert-danger" style="display: none;">
            Your summary cannot be the same as a part of the story.
          </div>
          
        </div>
      </div>

      <div class="row justify-content-center">
        <div class="col-11 section">
        <h4><label for="summary">Step 3: Tell us about yourself and this task</label></h4>
          <h5 class="mt-4">A. How difficult was this reading task?</h5>
          <div class="form-check form-check-inline ml-3 lickert text-right">
            <label class="form-check-label" for="difficult1" style="width: 10em;">Not difficult at all &nbsp;</label>
            <input class="form-check-input right" type="radio" name="difficult" id="difficult1" value="1" required>
          </div>
          <div class="form-check form-check-inline lickert">
            <label class="form-check-label" for="difficult2">&nbsp;</label>
            <input class="form-check-input right" type="radio" name="difficult" id="difficult2" value="2">
          </div>
          <div class="form-check form-check-inline lickert">
            <label class="form-check-label" for="difficult3">&nbsp;</label>
            <input class="form-check-input right" type="radio" name="difficult" id="difficult3" value="3">
          </div>
          <div class="form-check form-check-inline lickert">
            <label class="form-check-label" for="difficult4">&nbsp;</label>
            <input class="form-check-input right" type="radio" name="difficult" id="difficult4" value="4">
          </div>
          <div class="form-check form-check-inline lickert">
            <label class="form-check-label" for="difficult5">&nbsp;</label>
            <input class="form-check-input" type="radio" name="difficult" id="difficult5" value="5">
            <label class="form-check-label" for="difficult5">&nbsp; Very difficult</label>
          </div>
          
          <h5 class="mt-4">B. How distracted were you while reading the stories?</h5>
          <div class="form-check form-check-inline ml-3 lickert text-right" >
            <label class="form-check-label" for="distracted1" style="width: 10em;">Not distracted at all &nbsp;</label>
            <input class="form-check-input right" type="radio" name="distracted" id="distracted1" value="1" required>
          </div>
          <div class="form-check form-check-inline lickert">
            <label class="form-check-label" for="distracted2">&nbsp;</label>
            <input class="form-check-input right" type="radio" name="distracted" id="distracted2" value="2">
          </div>
          <div class="form-check form-check-inline lickert">
            <label class="form-check-label" for="distracted3">&nbsp;</label>
            <input class="form-check-input right" type="radio" name="distracted" id="distracted3" value="3">
          </div>
          <div class="form-check form-check-inline lickert">
            <label class="form-check-label" for="distracted4">&nbsp;</label>
            <input class="form-check-input right" type="radio" name="distracted" id="distracted4" value="4">
          </div>
          <div class="form-check form-check-inline lickert">
            <label class="form-check-label" for="distracted5">&nbsp;</label>
            <input class="form-check-input" type="radio" name="distracted" id="distracted5" value="5">
            <label class="form-check-label" for="distracted5">&nbsp; Very distracted</label>
          </div>
          
        <h5 class="mt-4">C. Tell us about yourself and this writing task</label><br><small>Select "prefer not to answer" if needed.</small></h5>
          <div class="form-group row mt-3">
            <label for="gender" class="col-sm-2 col-form-label">Gender identity</label>
            <div class="col-sm-4">
              <select id="annotatorGender" name="annotatorGender" class="form-control" style="font-size: .85rem;" required>
                <option disabled selected value="">-- please select --</option>
                <option value="man">Man/Male</option>
                <option value="woman">Woman/Female</option>
                <option value="nonBinary">Non-binary</option>
                <option value="other">Other</option>
                <option value="na">- prefer not to disclose -</option>
              </select>
            </div>
            <div class="col-sm-4"><small>Please select the gender identity you most identify with currently.</small></div>
          </div>
          <div class="form-group row">
            <label for="annotatorAge" class="col-sm-2 col-form-label">Age range</label>
            <div class="col-sm-4">
              <select id="annotatorAge" name="annotatorAge" class="form-control" style="font-size: .85rem;" required>
                <option disabled selected value="">-- please select --</option>
                <option value="18">18-24</option>
                <option value="25">25-29</option>
                <option value="30">30-34</option>
                <option value="35">35-39</option>
                <option value="40">40-44</option>
                <option value="45">45-49</option>
                <option value="50">50-54</option>
                <option value="55">55+</option>
                <option value="na">- prefer not to disclose -</option>
              </select>
            </div>

          </div>
          <div class="form-group row" >
            <label for="race" class="col-sm-2 col-form-label">Race/ethnicity</label>
            <div class="col-sm-4">
              <select id="annotatorRace" name="annotatorRace" class="form-control" style="font-size: .85rem;" required>
                <option disabled selected value="">-- please select --</option>
                <option value="asian">Asian/Asian American</option>
                <option value="indian">South Asian/Indian American</option>
                <option value="black">Black/African American</option>
                <option value="hisp">Hispanic/Latinx</option>
                <option value="white">White/Caucasian</option>
                <option value="middleEastern">Middle Eastern</option>
                <option value="islander">Native Hawaiian/Pacific Islander</option>
                <option value="native">Native American/First Nations</option>
                <option value="other">Mixed/other</option>
                <option value="na">- prefer not to disclose -</option>
              </select>
            </div>
            <div class="col-sm-4"><small>Please select the racial/ethnic identity you most identify with currently.</small></div>
          </div>
          <!--div class="form-group row">
            <label for="annotatorMinority" class="col-sm-12 col-form-label">
              Do you identify with any minority, disadvantaged, demographic, or other specific groups? If so, which one(s)?<br>
              <small>(E.g., racial, gender identity, sexuality, disability, immigrant, veteran, etc.); use commas to separate groups.</small>
            </label>
            <div class="col-sm-6">
              <input type="text" name="annotatorMinority" placeholder="" class="form-control" id="annotatorMinority" style="font-size: .85rem;">
            </div>
          </div-->
          
        </div>
      </div>
      <div class="row justify-content-center mb-4"><div class="col-11 section"></div>
        <div class="col-8 text-center" style="font-size: 10pt;">
          <p>
            Optional Feedback: Thanks for filling out hit above!
            If something about the hit was unclear, please either leave a comment in the box below!
            We would like to make this HIT easier for future workers, so we really appreciate feedback though it is optional.
            If you have concerns or questions, please email us!
          </p>
          <textarea id="commentbox" name="commentbox" class="form-control" style="width: 100%;"></textarea><br>
          <input type="submit" id="submitButton" class="btn btn-primary" value="Submit Hit!"> 
        </div>
        <div class="col-6 mt-2 alert alert-danger" id="cantSubmit" style="display: none;">
          You're missing some questions! Please responded to all questions:
          <ul>
            <li>All <strong>event questions</strong> in section 1</li>
            <li>The <strong>summary</strong> in section 2</li>
            <li>All <strong>fields</strong> in section 3</li>
          </ul>
          <p> If this message keeps popping up, make sure to re-click the event buttons on each story (again).</p>
        </div>
      </div>
    </div>      
  </div>
</div>
<script>
  var ogStoryJson = `["At seven in the morning of April 26, 1949, the sun was just up.", "It was cool.", "Mrs. Birch was in the yard between the back of the house and the garage doing a chore of some kind.", "She went through the front door into the kitchen.", "Mr. Birch came in and, after a friendly greeting, chatted with her for a minute or so.", "Mrs. Birch needed to awaken Raymond.", "Mrs. Birch stepped into Raymond's bedroom, pulled a light cord hanging from the center of the room, and turned to the bed.", "Mrs. Birch said with pleasant casualness, 'Raymond, wake up.'", "With a little more urgency in her voice she spoke again: 'Son, are you going to school today?'", "Raymond didn't respond immediately.", "He screwed up his face and whimpered a little.", "He lay still.", "His mother repeated, 'Raymond, wake up.'", "This was said pleasantly; the mother was apparently in good spirits and was willing to put up with her son's reluctance.", "Raymond whimpered again, and kicked his feet rapidly in protest.", "He squirmed around and rolled over crossways on the bed.", "His mother removed the covers.", "Raymond wore a T-shirt and pajama pants.", "He again kicked his feet in protest.", "He sat up and rubbed his eyes.", "Mrs. Birch took some clothes from the bureau and  laid them on the bed next to Raymond.", "There were a clean pair of socks, a clean pair of shorts, a white T-shirt and a striped T-shirt.", "Raymond's blue-jean pants were on a chair near the bed.", "Mrs. Birch continued to stand beside the bed.", "Raymond picked up a sock and began tugging and pulling it on his left foot.", "As his mother watched him she said kiddingly, 'Can't you get your peepers open?'", "Raymond stopped putting on his sock long enough to rub his eyes again.", "He appeared to be very sleepy.", "He said plaintively, 'Mommie,' and continued mumbling in an unintelligible way something about his undershirt.", "His mother asked, 'Do you want to put this undershirt on or do you want to wear the one you have on?'", "Raymond sleepily muttered something in reply.", "His mother left the room and went into the kitchen.", "Raymond struggled out of the T-shirt which he had on.", "He put on the clean striped T-shirt more efficiently.", "He pulled on his right sock.", "He picked up his left tennis shoe and put it on.", "He laced his left shoe with slow deliberation, looking intently at the shoe as he worked steadily until he had it all laced.", "He put on his right shoe.", "He laced up his right shoe.", "Again he worked intently, looking at the shoe as he laced it.", "His mother called, 'Raymond, do you want an egg for breakfast?'", "in a pleasant, inquiring tone.", "Raymond responded very sleepily, 'No.'", "His voice showed no irritation or resentment; he just answered in a matter-of-fact, sleepy way, 'No.'", "As he finished lacing his shoe, he called out in a rather plaintive voice, 'Mommie, come here.'", "Mrs. Birch didn't respond verbally, but her footsteps signaled her approach.", "When his mother came into the room, Raymond still had on his pajama pants; his shorts were lying on the bed next to him.", "Mrs. Birch came over to the bed and bent down close to Raymond.", "He whispered something to her.", "Mrs. Birch chuckled with slight embarrassment and said, laughingly, 'Well, take them off and put them on,'  meaning that he was to take off his pajama pants and put on his underpants.", "She stood next to him as he made the change.", "Mrs. Birch returned to the kitchen.", "Raymond put on his blue-jean pants as he stood by his bed.", "Honey, Raymond's fat, broad, elderly fox terrier, ambled into the room.", "Raymond greeted her in a sleepy but friendly voice, 'Hi, Honey.'", "Honey put her front paws on Raymond's knees.", "He scratched her back and patted her as he finished buckling his belt.", "Raymond turned to his dresser and rummaged around among the things on it until he obtained a candy Easter egg.", "He held up the candy and commanded, 'Sit up, Honey, sit up.'", "The dog obeyed promptly and Raymond pushed the candy into her mouth.", "Just then his mother said, from the hallway, 'Are you dressed, son?'", "Seeing that he was, she said, pleasantly, 'Then go and wash up.'", "Raymond immediately started for the bathroom.", "He went into the bathroom, left the door open, and washed briefly.", "He came out of the bathroom carrying a bottle of hair oil.", "He shook a few drops of oil into the palm of his hand and he stood before his mirror.", "He set down the bottle and massaged his hair and scalp with both hands.", "His father, who had been reading the morning paper in the living room, came by in the hall on his way to breakfast.", "He turned into Raymond's room and greeted him in a friendly, jocular way, 'Well, Clam, are you ready to eat?'", "Raymond promptly and easily replied, 'Sure.'", "Mr. Birch patted Raymond on the back, then turned and started toward the kitchen.", "On his way to the kitchen, Mr. Birch called out, teasingly, 'Well, let's get on the stick, Bub,' and repeated, 'Let's get on the stick, Bub.'", "Raymond said nothing, just went on combing his hair.", "Raymond finished with his hair rapidly, stroking it a few more times with the comb.", "Raymond went quickly, almost eagerly, into the kitchen.", "He went directly to the table.", "Raymond sat down before a glass of milk, a piece of buttered toast, and a dish of piping hot oatmeal with milk on it, ready to eat.", "Raymond picked up his piece of toast.", "He began stirring the cereal.", "While stirring his cereal, Raymond began munching on the toast.", "His parents talked casually back and forth to each other about the weather.", "While they talked, Raymond looked up and smiled pleasantly at various points in the conversation.", "He was quite content to sit and eat his breakfast and just listen.", "He was relaxed and calm.", "Raymond's mother said to him, 'What are you going to do with that shirt if you get hot, son?'", "Raymond mumbled lackadaisically through the toast in his mouth, 'I don't know.'", "His mother said in an offhand way, 'If you peel your shirt off, be careful not to lose it; it's a good shirt.'", "Raymond made no response, only went on munching his breakfast, which was to his liking.", "While he continued to eat quietly, he listened to the conversation of his parents.", "His father talked about going fishing.", "He said, 'A day like this makes me want to grab a fishing pole.'", "Mr. Birch said that he and Raymond had gone fishing a few days before.", "Raymond had been the only one who caught any fish.", "Raymond smiled at this reference to him.", "His father went on to explain how Raymond pulled the fish out.", "He said that Raymond's pole was too short and his string too long, so that when he got a bite, he just threw the pole over his shoulder and started running up the bank.", "Raymond smiled and glanced down at his plate.", "He appeared to be a bit embarrassed but at the same time proud.", "He went on eating.", "He was still listening to the conversation.", "His mother and father talked about the fact they had spent $30 in fuel bills during a single month of the winter.", "Raymond continued to eat with good appetite and to listen to the conversation.", "He went on eating and listening idly as his parents talked.", "He stopped eating almost entirely as he listened with awakened interest to the parents' talk about one of the men in town.", "Raymond said, 'Oh, I saw him yesterday coming out of the post office.'", "This was said with real interest.", "He welcomed the opportunity to take part in the conversation.", "Raymond sat back in his chair.", "He was nearly finished with his breakfast.", "He said, in a slightly complaining tone, 'Mommie, I don't want this other piece of toast.'", "His mother said casually, 'You don't?", "Well, O.K., I guess you don't have to eat it.'", "He finished eating his breakfast."]`;
  var sents1, sents2, sents3;
  var storyJsons = [`${sents1}`,`${sents2}`,`${sents3}`];
  var allSents = [];
  var sentLengths = {1: 0, 2: 0, 3: 0};
  var e, sents, curSentIx = 0;
  var curSentIxs = {1: 0, 2: 0, 3: 0};
  //var characters = shapes; //"QWERTYUIOPASDFGHJKLZXCVBNM1234567890";
  var condition;
  var curSIX = 1;
  
  $(document).ready(function(){
    if (location.host == "homes.cs.washington.edu")
      storyJsons = [ogStoryJson, ogStoryJson, ogStoryJson];
    createSentenceForms(1);
    updateProgress(1);
    // $("#sent1-"+(sents.length-1)+"-next").prop("disabled",true).val("you reached the end!").removeClass("btn-primary").addClass("btn-secondary");
    createSentenceForms(2);
    updateProgress(2);
    createSentenceForms(3);
    updateProgress(3);

    
    //$("#sent2-0").show();
    //$("#sent3-0").show();
    // curSentIx = 0;
    
    // $(".story-length").text(sents.length);
    
    
    
    if (location.host == "homes.cs.washington.edu"){
      toggleConsent(true);
      $("#consent").prop("checked",true);
      $(".debug").show();
    }
  });
  function createSentenceForms(sIx){
    allSents[sIx-1] = JSON.parse(storyJsons[sIx-1]);//.slice(0,Math.round(10*Math.random()+2));
    sentLengths[sIx] = allSents[sIx-1].length;
    var slider = $("#story"+sIx+"-slider");
    var sentDiv = $("#story-slider-placeholder").html();
    //console.log(sentDiv)
    
    allSents[sIx-1].forEach(function(s,i){
      var newDiv = sentDiv.replace(new RegExp("sentY-X","g"),"sent"+sIx+"-"+i);
      newDiv = newDiv.replace("sentText",s);
      newDiv = newDiv.replace(new RegExp("nextSentence\\(Y\\)","g"),"nextSentence("+sIx+")");
      //newDiv = newDiv.replace("nextSentence(Y)","nextSentence("+sIx+")").replace("nextSentence(Y)","nextSentence("+sIx+")").replace("nextSentence(Y)","nextSentence("+sIx+")");
      newDiv = newDiv.replace("sentIX",i+1);
      //if (i<6){
      slider.append(newDiv);
      //}
    });
    $('input[name="sentY-X-newEvent"]').prop("required",false);
    var lastBtn = $('input#sent'+sIx+"-"+(sentLengths[sIx]-1)+'-no').parent();
    lastBtn.find("span").text("No new event, finish reading");
    $("#sent"+sIx+"-0").show();
  }
  function nextSentence(sIx){
    var curDiv = $("#sent"+sIx+"-"+curSentIxs[sIx]);

    if (curDiv.find("input:checked").length>0){
      if ((curSentIxs[sIx] +1) != sentLengths[sIx]) {
        curDiv.hide();
        $("#sent"+sIx+"-"+curSentIxs[sIx]+">div>.form-check").removeClass("invalid");
        curSentIxs[sIx] += 1;
        $("#sent"+sIx+"-"+curSentIxs[sIx]).show();
      } else {
        // the end
        if (sIx == 3){
          scrollToAnchor("#step2");
        }
        else if (sIx == 1){
          scrollToAnchor("#story2");
          //curSentIx = 0;
          curSIX = 2;
        }
        else if (sIx == 2){
          scrollToAnchor("#story3");
          //curSentIx = 0;
          curSIX = 3;
        }
      }
    } else {
      $("#sent"+curSentIxs[sIx]+">div>.form-check").addClass("invalid");
    }
    updateProgress(sIx);
  }
  function scrollToAnchor(aid){
    console.log(aid);
    var aTag = $(aid);
    $('html,body').animate({scrollTop: aTag.offset().top},'slow');
  }
  function toggleConsent(checked){
    if (checked){
      $("#main-task").show();
      $("#consent-message").hide();
      //$("#fullInstructions").collapse("hide");
      scrollToAnchor("#step1");
    } else {
      $("#main-task").hide();
      $("#consent-message").show();
      //$("#fullInstructions").collapse("show");
    }
  }
  function updateProgress(sIx){
    $("#progressBar"+sIx).val(100*(1+curSentIxs[sIx])/sentLengths[sIx]);
  }
  function countSentences(text){
    var match = text.match(/[\w\)"][.?!](?:\s|$)/gm);
    return match === null ? 0: match.length;
  }
  function updateCounter(el,minS,maxS,minC,maxC){
    var name = el.id;
    var counter = $("#"+name+"-sentence-counter");
    var text = $(el).prop("value");
    var nSents = countSentences(text);
    var nChars = text.length;
    var warnText = "";
    counter.css('color', 'black');

    if (nSents >= minS && nChars < maxC)
      warnText = " &#x2713;";
    
    if (nSents > maxS || nChars > maxC) {
      warnText = " (try shortening it)";
      counter.css('color', '#721c24');
    } 
    counter.html(nSents+" sentences ("+nChars+" characters) detected"+warnText);
  }
  
  
  function checkSummary(){
    var summary = $("#summary").prop("value").trim();
    var story = allSents.map(e => e.join(" ")).join(" ");
    if (summary.length > 0 && story.indexOf(summary) != -1) {
      $("#summary-duplicate-warning").show();
      return false;
    } else {
      $("#summary-duplicate-warning").hide();
    }
    var nSents = countSentences(summary);
    if (summary.length > 100 && summary.length < 1000) {
      $("#summary").attr("data-state","open");
      $("#summary-length-warning").hide();
      return true;
    } else {
      $("#summary").attr("data-state","invalid");
      $("#summary-length-warning").show();
      return false;
    }
  }
  
  //(\r\n|\n|\r)
  $("#submitButton").on("click",function(e){
    var ok = true; 
    for (var i=1; i<4;i++){
      ok = ok && (curSentIxs[i] == sentLengths[i]-1);
      if (ok){
        $("#sent"+i+"-"+curSentIxs[i]+">div>label").removeClass("btn-danger");
      } else{
        $("#sent"+i+"-"+curSentIxs[i]+">div>label").addClass("btn-danger");
      }     
    }
    console.log("Finished stories? "+ok);

    ok = ok && checkSummary();
    console.log("Summary ok? "+ok);
        
    ok = ok && ($(":invalid").length == 0);
    
    console.log("All fields valid? "+ok);
    $(":valid").removeClass("invalid");
    $(".lickert>input:valid").parents().removeClass("invalid");
    $(".form-check>input:valid").parents().removeClass("invalid");
    if (!ok) {
      $("#cantSubmit").show();
      $(":invalid").addClass("invalid");
      $(".lickert>input:invalid").parents().addClass("invalid");
      $(".form-check>input:invalid").parents().addClass("invalid");
      e.preventDefault();
    } else{
      $("#cantSubmit").hide();
    }
  });

  
</script>
<style type="text/css">
  h3, h4, h5, h6 {
    font-weight: 400;
  }
  .section {
    border-top: solid darkgrey .75px;
    padding-top: 15px;
  }
  .lickert>label{
    font-size: smaller;
  }
  textarea[data-state="open"] {
    background-color: white; 
    border-color: #ced4da;
    color: #495057;
  }
  textarea[data-state="invalid"],
  textarea[data-state="invalid"]:active,
  textarea[data-state="invalid"]:focus,
  textarea[data-state="invalid"]:focus-within {
    background-color: #f5c6cb; 
    border-color: #D22437;
    color: #721c24;
  }
  
  input.form-check-input {
    padding-right: 10px;
  }
  ul>li:before{
    margin-left: -1em;
    margin-right: .25em;
  }
  ul>li.corr:before {
    content: "\2713";
  }
  ul>li.inco:before {
    content: "\2717";
  }
  input.form-check-input.right:after {
    /*
    position: absolute;
    bottom: 0;
    left: .5em;
    right: 0;
    content: "";
    height: 0.75em;
    border-top: 1px solid black;*/
  }
  
  .form-check.invalid,
  .lickert.invalid,
  input.invalid, 
  select.invalid {
    border: .1em solid #D22437;
    border-radius: .1em;
    background-color: #f5c6cb;
    padding: .1em;
  }
  .btn.invalid {
    border: .1em solid #D22437;
  }
  .sentence, .sentence:disabled {
    border: 1px solid darkgrey;
    border-radius: 5px;
    text-align: left;
    background-color: whitesmoke;
    padding: 5px;
  }
  .story-display {
    margin: 20em 0;
    padding: 1em;
    border-radius: 1em;
    border: solid 1px black;
    background-color: #DCDCDC;  
  }
  .btn-left{
    text-align: left;
    width: 100%;
    white-space: normal;
  }
  .sent-counter {
    display: none;
  }
</style>





